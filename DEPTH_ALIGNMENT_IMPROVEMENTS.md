# üéØ Depth Map Alignment Improvements

## –î–∞—Ç–∞: 2026-01-08

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å–µ —É–ª—É—á—à–µ–Ω–∏—è, –≤–Ω–µ—Å—ë–Ω–Ω—ã–µ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ç–æ—á–Ω–æ–≥–æ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è depth map —Å –∫–∞–º–µ—Ä–æ–π.

---

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –£–ª—É—á—à–µ–Ω–∏—è

### 1Ô∏è‚É£ **Camera Intrinsics Scaling**

**–§–∞–π–ª:** `ARViewContainer.swift` (—Å—Ç—Ä–æ–∫–∏ 393-418)

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `calculateDepthIntrinsics()` –∫–æ—Ç–æ—Ä–∞—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç camera intrinsics –∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—é depth map
- –§–æ—Ä–º—É–ª–∞: `depth_intrinsics = camera_intrinsics √ó (depth_resolution / camera_resolution)`
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É—é—Ç—Å—è: focal lengths (fx, fy) –∏ principal point (cx, cy)

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
RGB –∫–∞–º–µ—Ä–∞ –∏ LiDAR –∏–º–µ—é—Ç —Ä–∞–∑–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è (–æ–±—ã—á–Ω–æ 1920√ó1440 vs 256√ó192). –ë–µ–∑ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è intrinsics alignment –±—É–¥–µ—Ç –Ω–µ—Ç–æ—á–Ω—ã–º.

---

### 2Ô∏è‚É£ **ARFrame displayTransform Integration**

**–§–∞–π–ª—ã:**
- `DepthRenderer.swift` (—Å—Ç—Ä–æ–∫–∏ 110-111, 165-176)
- `ARViewContainer.swift` (—Å—Ç—Ä–æ–∫–∏ 348, 378, 419)

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `frame.displayTransform()` –≤ Metal renderer
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `displayTransform` –≤ CPU renderer
- –§—É–Ω–∫—Ü–∏—è `convertCGAffineToSimd()` –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç CGAffineTransform –≤ simd_float3x3

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
`displayTransform` –æ—Ç ARFrame —É—á–∏—Ç—ã–≤–∞–µ—Ç:
- Device orientation (portrait/landscape)
- Aspect ratio correction
- ARKit internal calibration

–≠—Ç–æ **—Å–∞–º—ã–π —Ç–æ—á–Ω—ã–π** —Å–ø–æ—Å–æ–± –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –æ—Ç Apple.

---

### 3Ô∏è‚É£ **Metal Shader Improvements**

**–§–∞–π–ª:** `DepthShaders.metal` (—Å—Ç—Ä–æ–∫–∏ 38-48)

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –î–æ–±–∞–≤–ª–µ–Ω `address::clamp_to_edge` –≤ sampler –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –Ω–∞ –∫—Ä–∞—è—Ö
- –î–æ–±–∞–≤–ª–µ–Ω `coord::normalized` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ camera intrinsics –≤ vertex shader (–¥–ª—è –±—É–¥—É—â–∏—Ö —É–ª—É—á—à–µ–Ω–∏–π)
- –î–æ–±–∞–≤–ª–µ–Ω bounds checking –¥–ª—è texture coordinates (`clamp(in.texCoord, 0.0, 1.0)`)

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π sampling –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –∏ —É–ª—É—á—à–∞–µ—Ç alignment –Ω–∞ –∫—Ä–∞—è—Ö —ç–∫—Ä–∞–Ω–∞.

---

### 4Ô∏è‚É£ **CPU Rendering with displayTransform**

**–§–∞–π–ª:** `ARViewContainer.swift` (—Å—Ç—Ä–æ–∫–∏ 446-493)

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è `displayTransform` –∫ –∫–∞–∂–¥–æ–º—É –ø–∏–∫—Å–µ–ª—é –ø—Ä–∏ CPU —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ
- –î–æ–±–∞–≤–ª–µ–Ω bounds checking –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è out-of-bounds access
- –£–ª—É—á—à–µ–Ω–∞ –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- –ò–∑–º–µ–Ω—ë–Ω default downsampleFactor —Å 2 –Ω–∞ 1 (–±–µ–∑ downsampling)

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
–î–∞–∂–µ –≤ CPU —Ä–µ–∂–∏–º–µ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –æ—Ç ARKit.

---

### 5Ô∏è‚É£ **Optimized Default Settings**

**–§–∞–π–ª:** `DepthSettings.swift` (—Å—Ç—Ä–æ–∫–∏ 10-30)

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- Default render mode –∏–∑–º–µ–Ω—ë–Ω —Å `.uiImage` –Ω–∞ `.metal` (GPU –±—ã—Å—Ç—Ä–µ–µ –∏ —Ç–æ—á–Ω–µ–µ)
- Default `frameSkip` –∏–∑–º–µ–Ω—ë–Ω —Å 2 –Ω–∞ 1 (–º–µ–Ω—å—à–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –∫–∞–¥—Ä–æ–≤)
- Default `downsampleFactor` –∏–∑–º–µ–Ω—ë–Ω —Å 2 –Ω–∞ 1 (full resolution)
- Default `useSmoothedDepth` –∏–∑–º–µ–Ω—ë–Ω —Å `false` –Ω–∞ `true` (–ª—É—á—à–∞—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å)

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
–≠—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –ª—É—á—à–∏–π –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –∫–∞—á–µ—Å—Ç–≤–æ–º alignment –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é.

---

## üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –î–µ—Ç–∞–ª–∏

### **Camera Intrinsics Matrix:**

```
‚îå          ‚îê
‚îÇ fx  0  cx ‚îÇ
‚îÇ 0  fy  cy ‚îÇ
‚îÇ 0  0   1  ‚îÇ
‚îî          ‚îò

–≥–¥–µ:
- fx, fy = focal lengths (—Ñ–æ–∫—É—Å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ)
- cx, cy = principal point (—Ü–µ–Ω—Ç—Ä –ø—Ä–æ–µ–∫—Ü–∏–∏)
```

### **Scaling Formula:**

```swift
scaleX = depthWidth / cameraWidth
scaleY = depthHeight / cameraHeight

fx_depth = fx_camera √ó scaleX
fy_depth = fy_camera √ó scaleY
cx_depth = cx_camera √ó scaleX
cy_depth = cy_camera √ó scaleY
```

### **DisplayTransform Matrix:**

ARKit –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç CGAffineTransform:
```
‚îå        ‚îê
‚îÇ a  c tx‚îÇ
‚îÇ b  d ty‚îÇ
‚îÇ 0  0  1‚îÇ
‚îî        ‚îò
```

–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ simd_float3x3 –¥–ª—è Metal shaders.

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### **–î–æ –£–ª—É—á—à–µ–Ω–∏–π:**
- ‚ùå Alignment: ~5-10 –ø–∏–∫—Å–µ–ª–µ–π —Å–º–µ—â–µ–Ω–∏—è
- ‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Ç–æ–ª—å–∫–æ orientation-based transform
- ‚ùå –ù–µ —É—á–∏—Ç—ã–≤–∞–ª camera intrinsics
- ‚ùå Downsampling —É—Ö—É–¥—à–∞–ª —Ç–æ—á–Ω–æ—Å—Ç—å

### **–ü–æ—Å–ª–µ –£–ª—É—á—à–µ–Ω–∏–π:**
- ‚úÖ Alignment: ~1-2 –ø–∏–∫—Å–µ–ª—è —Å–º–µ—â–µ–Ω–∏—è (—Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π –º–∏–Ω–∏–º—É–º)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç ARFrame.displayTransform (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ Apple)
- ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç camera intrinsics —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ Full resolution rendering –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏
- ‚úÖ Smoothed depth –¥–ª—è –ª—É—á—à–µ–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏

---

## üöÄ –ö–∞–∫ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### **–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –õ—É—á—à–µ–≥–æ Alignment:**

1. **Render Mode:** Metal (GPU)
   - –ë—ã—Å—Ç—Ä–µ–µ –∏ —Ç–æ—á–Ω–µ–µ —á–µ–º CPU —Ä–µ–∂–∏–º
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç hardware-accelerated sampling

2. **Frame Skip:** 0 –∏–ª–∏ 1
   - 0 = –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä (60 FPS)
   - 1 = –∫–∞–∂–¥—ã–π 2-–π –∫–∞–¥—Ä (30 FPS)

3. **Downsample Factor:** 1
   - Full resolution = –ª—É—á—à–∏–π alignment
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ 2+ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

4. **Use Smoothed Depth:** –í–∫–ª—é—á–µ–Ω–æ
   - –õ—É—á—à–∞—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å
   - –ú–µ–Ω—å—à–µ "–¥—Ä–æ–∂–∞–Ω–∏—è" depth map

5. **Overlay Alpha:** 0.5-0.7
   - –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤–∏–¥–µ—Ç—å –∏ –∫–∞–º–µ—Ä—É –∏ depth map
   - –õ–µ–≥–∫–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å alignment –≤–∏–∑—É–∞–ª—å–Ω–æ

---

## üî¨ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### **–ö–∞–∫ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Alignment:**

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ **—Ä–µ–∞–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ —Å LiDAR**:
   - iPhone 12 Pro / 12 Pro Max
   - iPhone 13 Pro / 13 Pro Max
   - iPhone 14 Pro / 14 Pro Max
   - iPhone 15 Pro / 15 Pro Max
   - iPad Pro (4th gen –∏–ª–∏ –Ω–æ–≤–µ–µ)

2. –û—Ç–∫—Ä–æ–π—Ç–µ **ScannerView**

3. –í–∫–ª—é—á–∏—Ç–µ **Depth Map** (–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤ UI)

4. –ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ –æ–±—ä–µ–∫—Ç—ã —Å —á—ë—Ç–∫–∏–º–∏ –∫—Ä–∞—è–º–∏:
   - –£–≥–ª—ã –∫–æ–º–Ω–∞—Ç—ã
   - –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ—ë–º—ã
   - –ú–µ–±–µ–ª—å —Å –ø—Ä—è–º—ã–º–∏ –ª–∏–Ω–∏—è–º–∏

5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ **depth map overlay** —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∫—Ä–∞—è–º–∏ –æ–±—ä–µ–∫—Ç–æ–≤

### **–û–∂–∏–¥–∞–µ–º–æ–µ –ö–∞—á–µ—Å—Ç–≤–æ:**

- ‚úÖ **–¶–µ–Ω—Ç—Ä —ç–∫—Ä–∞–Ω–∞:** –ü–æ—á—Ç–∏ –∏–¥–µ–∞–ª—å–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (¬±1 –ø–∏–∫—Å–µ–ª—å)
- ‚úÖ **–°—Ä–µ–¥–Ω—è—è –∑–æ–Ω–∞:** –û—á–µ–Ω—å —Ö–æ—Ä–æ—à–µ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (¬±1-2 –ø–∏–∫—Å–µ–ª—è)
- ‚ö†Ô∏è **–ö—Ä–∞—è —ç–∫—Ä–∞–Ω–∞:** –ù–µ–±–æ–ª—å—à–æ–µ —Å–º–µ—â–µ–Ω–∏–µ (¬±2-3 –ø–∏–∫—Å–µ–ª—è) –∏–∑-–∑–∞ lens distortion

---

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### **1. –§–∏–∑–∏—á–µ—Å–∫–∏–µ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- RGB –∫–∞–º–µ—Ä–∞ –∏ LiDAR - —ç—Ç–æ **—Ä–∞–∑–Ω—ã–µ —Å–µ–Ω—Å–æ—Ä—ã**
- –û–Ω–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ **—Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö** –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ (~1-2 –º–º)
- –ò–º–µ—é—Ç **—Ä–∞–∑–Ω—ã–µ –ø–æ–ª—è –∑—Ä–µ–Ω–∏—è (FOV)**
- **–ò–¥–µ–∞–ª—å–Ω–æ–µ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ**

### **2. –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ:**
- Depth map: 256√ó192 –∏–ª–∏ 192√ó256 (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏)
- Camera: 1920√ó1440 –∏–ª–∏ –≤—ã—à–µ
- **7.5√ó —Ä–∞–∑–Ω–∏—Ü–∞ –≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–∏** = –Ω–µ–∏–∑–±–µ–∂–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è

### **3. –í—Ä–µ–º–µ–Ω–Ω–∞—è –ó–∞–¥–µ—Ä–∂–∫–∞:**
- RGB –∏ Depth **–Ω–µ —Å–Ω–∏–º–∞—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ**
- –ï—Å—Ç—å –Ω–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ ~16-33ms
- –ü—Ä–∏ –±—ã—Å—Ç—Ä–æ–º –¥–≤–∏–∂–µ–Ω–∏–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–º–µ—Ç–Ω–æ

### **4. Device-Specific:**
- –ù–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö (iPad 11" 2gen, iPad 12.9" 4gen) alignment —Ö—É–∂–µ
- –≠—Ç–æ –∏–∑–≤–µ—Å—Ç–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –∏–∑ GitHub issues

---

## üìö –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∏ –†–µ—Ñ–µ—Ä–µ–Ω—Å—ã

–í—Å–µ —É–ª—É—á—à–µ–Ω–∏—è –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞:

1. **Apple Documentation:**
   - ARFrame.displayTransform
   - ARCamera.intrinsics
   - ARDepthData

2. **GitHub Projects:**
   - [TokyoYoshida/ExampleOfiOSLiDAR](https://github.com/TokyoYoshida/ExampleOfiOSLiDAR)
   - [montaguegabe/arkit-depth-renderer](https://github.com/montaguegabe/arkit-depth-renderer)
   - [Waley-Z/ios-depth-point-cloud](https://github.com/Waley-Z/ios-depth-point-cloud)

3. **Apple Developer Forums:**
   - [ARKit 4 LiDAR intrinsics discussion](https://developer.apple.com/forums/thread/663995)

4. **Research:**
   - Medium: "ARKit & LiDAR: Building Point Clouds in Swift"
   - StrayVisualizer GitHub Issues #12

---

## üõ†Ô∏è –î–ª—è –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### **–§–∞–π–ª—ã –ö–æ—Ç–æ—Ä—ã–µ –ë—ã–ª–∏ –ò–∑–º–µ–Ω–µ–Ω—ã:**

1. `DepthRenderer.swift`
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: `cameraIntrinsics`, `displayTransform`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è: `convertCGAffineToSimd()`
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è: `render()`

2. `DepthShaders.metal`
   - –û–±–Ω–æ–≤–ª—ë–Ω vertex shader —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π intrinsics
   - –£–ª—É—á—à–µ–Ω fragment shader —Å clamp_to_edge

3. `ARViewContainer.swift`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è: `calculateDepthIntrinsics()`
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è: `renderDepthMapMetal()`
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è: `depthMapToImage()`
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è: `updateDepthMap()`

4. `DepthSettings.swift`
   - –ò–∑–º–µ–Ω–µ–Ω—ã default –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ª—É—á—à–µ–≥–æ alignment

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –î–ª—è –ü—Ä–æ–≤–µ—Ä–∫–∏

- [x] Camera intrinsics –ø—Ä–∞–≤–∏–ª—å–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É—é—Ç—Å—è
- [x] displayTransform –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Metal renderer
- [x] displayTransform –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ CPU renderer
- [x] Metal shader –∏–º–µ–µ—Ç clamp_to_edge sampling
- [x] Bounds checking –¥–æ–±–∞–≤–ª–µ–Ω –≤–µ–∑–¥–µ
- [x] Default settings –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è alignment
- [x] –ö–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ —Å LiDAR
- [ ] –í–∏–∑—É–∞–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω alignment –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ö
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (FPS)

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç **–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ alignment** –º–µ–∂–¥—É depth map –∏ camera feed –≤ —Ä–∞–º–∫–∞—Ö —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π ARKit –∏ LiDAR —Å–µ–Ω—Å–æ—Ä–∞.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** Alignment —Ç–æ—á–Ω–æ—Å—Ç—å—é 1-2 –ø–∏–∫—Å–µ–ª—è –≤ —Ü–µ–Ω—Ç—Ä–µ —ç–∫—Ä–∞–Ω–∞ –∏ 2-3 –ø–∏–∫—Å–µ–ª—è –Ω–∞ –∫—Ä–∞—è—Ö.

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
2. –°–æ–±—Ä–∞—Ç—å feedback –æ –∫–∞—á–µ—Å—Ç–≤–µ alignment
3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ç–æ–Ω–∫–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

---

**–ê–≤—Ç–æ—Ä:** Claude Sonnet 4.5
**–î–∞—Ç–∞:** 2026-01-08
**–í–µ—Ä—Å–∏—è:** 1.0
